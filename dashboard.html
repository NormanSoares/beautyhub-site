<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>67 Beauty Hub - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-size: 1rem;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }


        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #4caf50;
        }

        .status-offline {
            background: #f44336;
        }

        .connectivity-status {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }

        .connectivity-status h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 14px;
        }

        /* Estilos para gr√°fico de vendas */
        .sales-chart {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .chart-bars {
            display: flex;
            align-items: end;
            justify-content: space-between;
            height: 250px;
            padding: 0 20px;
            border-bottom: 2px solid #dee2e6;
            border-left: 2px solid #dee2e6;
        }

        .chart-bar {
            background: linear-gradient(to top, #ff6b6b, #ff8e8e);
            border-radius: 4px 4px 0 0;
            min-width: 30px;
            margin: 0 2px;
            position: relative;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            background: linear-gradient(to top, #ff5252, #ff7979);
            transform: scaleY(1.05);
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            margin-top: 10px;
        }

        .chart-label {
            font-size: 12px;
            color: #666;
            text-align: center;
            min-width: 30px;
        }

        .chart-values {
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            margin-bottom: 10px;
            font-size: 12px;
            color: #666;
        }

        .chart-value {
            text-align: center;
            min-width: 30px;
        }

        .sales-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .sales-stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .sales-stat h4 {
            margin: 0 0 5px 0;
            color: #495057;
            font-size: 14px;
        }

        .sales-stat .value {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }



        /* Estilos para produtos dos fornecedores */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .product-card.real-data {
            border-left: 4px solid #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #ffffff 100%);
        }
        
        .product-card.real-api-data {
            border-left: 4px solid #ff6b35;
            background: linear-gradient(135deg, #fff5f0 0%, #ffffff 100%);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
        }
        
        .product-card.scraped-data {
            border-left: 4px solid #007bff;
            background: linear-gradient(135deg, #f0f8ff 0%, #ffffff 100%);
            overflow: hidden;
        }
        
        .data-source-indicator {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }
        
        .data-source-indicator.scraped-indicator {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1976d2;
            border: 1px solid #90caf9;
        }
        
        .data-source-indicator.api-indicator {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            color: #388e3c;
            border: 1px solid #a5d6a7;
        }
        
        .data-source-indicator.local-indicator {
            background: linear-gradient(135deg, #fff3e0 0%, #ffcc02 100%);
            color: #f57c00;
            border: 1px solid #ffb74d;
        }
        
        .data-source-indicator.aliexpress-indicator {
            background: linear-gradient(135deg, #e8f5e8 0%, #4caf50 100%);
            color: #2e7d32;
            border: 1px solid #66bb6a;
        }
        
        .data-source-indicator.amazon-indicator {
            background: linear-gradient(135deg, #fff3e0 0%, #ff9800 100%);
            color: #e65100;
            border: 1px solid #ffb74d;
        }
        
        .data-source-indicator.real-api-indicator {
            background: linear-gradient(135deg, #e8f5e8 0%, #4caf50 100%);
            color: #1b5e20;
            border: 2px solid #4caf50;
            font-weight: bold;
        }
        
        .data-source-indicator.hybrid-indicator {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .hybrid-header {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .hybrid-breakdown {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 15px;
        }
        
        .fornecedores-data, .scraper-data {
            flex: 1;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }
        
        .hybrid-stats {
            text-align: center;
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Estilos para pedidos */
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .order-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .order-id {
            font-weight: bold;
            color: #007bff;
            font-size: 16px;
        }
        
        .order-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-processing {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-shipped {
            background: #d4edda;
            color: #155724;
        }
        
        .status-delivered {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .order-details {
            margin-bottom: 15px;
        }
        
        .order-details > div {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .order-tracking {
            margin-bottom: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        .order-tracking small {
            display: block;
            color: #666;
            margin-bottom: 4px;
        }
        
        .order-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-small:first-child {
            background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
            color: white;
        }
        
        .btn-small:last-child {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        /* Estilos para sistema de pedidos */
        .btn-micro {
            padding: 4px 8px;
            font-size: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-micro.primary {
            background: #007bff;
            color: white;
        }
        
        .btn-micro.secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-micro:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        /* Tabela de pedidos */
        .orders-table-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .orders-table {
            overflow-x: auto;
        }
        
        .orders-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .orders-table th,
        .orders-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .orders-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }
        
        .orders-table tr:hover {
            background: #f8f9fa;
        }
        
        .editable-field {
            border: 1px solid transparent;
            padding: 4px 6px;
            border-radius: 4px;
            transition: all 0.3s ease;
            background: transparent;
        }
        
        .editable-field:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        
        .editable-field:focus {
            border-color: #007bff;
            background: white;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-processing {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-shipped {
            background: #d4edda;
            color: #155724;
        }
        
        .status-delivered {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* Indicador de carregamento */
        .loading-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 200px;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .platform-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
        }

        .platform-badge.aliexpress {
            background: #ff6b35;
        }

        .platform-badge.amazon {
            background: #ff9900;
        }

        .price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #28a745;
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            line-height: 1.4;
        }

        .product-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .rating {
            color: #ffc107;
        }

        .stock.in_stock {
            color: #28a745;
        }

        .stock.out_of_stock {
            color: #dc3545;
        }

        .product-actions {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 15px;
        }

        .btn-small {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 140px;
            text-align: center;
        }

        .btn-small:first-child {
            background: #0066cc;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 102, 204, 0.3);
        }

        .btn-small:first-child:hover {
            background: #0052a3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.4);
        }

        .btn-small:last-child {
            background: #6c757d;
            color: white;
        }

        .btn-small:last-child:hover {
            background: #545b62;
        }
        
        .scraped-data {
            border: 2px solid #ff6b35 !important;
            background: linear-gradient(135deg, #fff5f0 0%, #ffe8e0 100%);
        }
        
        .scraped-data .platform-badge {
            background: #ff6b35 !important;
            color: white;
        }
        
        .real-api-data {
            border: 2px solid #28a745 !important;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }
        
        .real-api-data .platform-badge {
            background: #28a745 !important;
            color: white;
        }
        
        .local-data {
            border: 2px solid #6c757d;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .data-source-indicator {
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }
        
        .scraped-indicator {
            background: #ff6b35;
        }
        
        .api-indicator {
            background: #28a745;
        }
        
        .local-indicator {
            background: #6c757d;
        }
        
        .product-info {
            margin-top: 8px;
            padding: 8px;
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
            font-size: 11px;
        }
        
        .product-info small {
            display: block;
            margin: 2px 0;
            color: #666;
        }
        
        .price-current {
            color: #28a745;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .price-original {
            color: #6c757d;
            text-decoration: line-through;
        }
        
        .discount {
            color: #dc3545;
            font-weight: bold;
            background: #f8d7da;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .stock {
            color: #17a2b8;
            font-weight: bold;
        }
        
        .rating {
            color: #ffc107;
            font-weight: bold;
        }
        
        .source {
            font-size: 0.9em;
            padding: 2px 6px;
            border-radius: 4px;
            background: #e9ecef;
        }
        
        .timestamp {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .price-summary {
            border: 1px solid #dee2e6;
        }
        
        .automation-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: pulse 2s infinite;
        }
        
        .automation-indicator.inactive {
            background: #6c757d;
            animation: none;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    
    <div class="container">
        <div class="header">
            <h1>üèÜ 67 Beauty Hub</h1>
            <p>Dashboard de Monitoramento e An√°lise</p>
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="loading-spinner"></div>
                <span>Carregando dados...</span>
            </div>
        </div>

        <!-- Estat√≠sticas Gerais -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3 id="totalProducts">-</h3>
                <p>Total de Produtos</p>
            </div>
            <div class="stat-card">
                <h3 id="totalAlerts">-</h3>
                <p>Alertas de Pre√ßo</p>
            </div>
            <div class="stat-card">
                <h3 id="productsToday">-</h3>
                <p>Produtos Hoje</p>
            </div>
            <div class="stat-card">
                <h3 id="alertsToday">-</h3>
                <p>Alertas Hoje</p>
            </div>
        </div>

        <!-- Hist√≥rico de Vendas -->
        <div class="section">
            <h2>üìà Hist√≥rico de Vendas</h2>
            <div id="salesHistory">
                <div class="loading">Carregando hist√≥rico de vendas...</div>
            </div>
        </div>



        <!-- Pre√ßos Ativos -->
        <div class="section">
            <h2>üí∞ Pre√ßos Ativos dos Produtos</h2>
            <div id="activeAlerts">
                <div class="loading">Carregando pre√ßos dos produtos...</div>
            </div>
        </div>

        <!-- An√°lise de Tend√™ncias -->
        <div class="section">
            <h2>üìà An√°lise de Tend√™ncias</h2>
            <div id="trendsAnalysis">
                <div class="loading">Carregando an√°lise...</div>
            </div>
        </div>

        <!-- Sistema de Dropshipping -->
        <div class="section">
            <h2>üöÄ Sistema de Dropshipping</h2>
            
            
            <!-- Status da Automa√ß√£o -->
            <div id="automationStatus" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; display: none;">
                <h4>ü§ñ Status da Automa√ß√£o</h4>
                <div id="automationInfo" class="loading">Carregando status...</div>
            </div>
            
            <div class="stats-grid" id="dropshippingStats">
                <div class="stat-card" onclick="toggleDropshippingSystem()" style="cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <h3 id="dropshippingStatus">Offline</h3>
                    <p>Status do Sistema</p>
                    <small style="color: #666; font-size: 10px;">üí° Ative no openservice.aliexpress.com primeiro</small>
                </div>
                <div class="stat-card">
                    <h3 id="dropshippingProducts">0</h3>
                    <p>Total Produtos</p>
                </div>
                <div class="stat-card">
                    <h3 id="aliexpressProducts">0</h3>
                    <p>AliExpress</p>
                </div>
                <div class="stat-card">
                    <h3 id="amazonProducts">0</h3>
                    <p>Amazon</p>
                </div>
                <div class="stat-card">
                    <h3 id="inStockProducts">0</h3>
                    <p>Em Estoque</p>
                </div>
                <div class="stat-card">
                    <h3 id="dropshippingOrders">0</h3>
                    <p>Pedidos</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div>
                    <h3>üì¶ Invent√°rio</h3>
                    <div id="inventoryStatus" class="loading">Carregando invent√°rio...</div>
                </div>
                
                <div>
                    <h3>üö® Alertas de Estoque</h3>
                    <div id="stockAlerts" class="loading">Carregando alertas...</div>
                </div>
            </div>
            
            <!-- Produtos dos Fornecedores -->
            <div style="margin-top: 30px;">
                <h3>üõçÔ∏è Produtos dos Fornecedores</h3>
                <div class="dropshipping-controls" style="margin-bottom: 20px;">
                    <button class="btn" onclick="loadRealProducts('aliexpress')">üõí AliExpress</button>
                    <button class="btn" onclick="loadRealProducts('amazon')" disabled style="opacity: 0.5;">üì¶ Amazon (Pendente)</button>
                </div>
                <div id="realProductsContainer" class="loading">
                    Carregando produtos dos fornecedores...
                </div>
            </div>
            
            <!-- Sistema de Pedidos -->
            <div style="margin-top: 30px;">
                <div class="orders-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>üì¶ Sistema de Pedidos Dropshipping</h3>
                    <div class="order-controls">
                        <button class="btn" onclick="createTestOrder()">üß™ Criar Pedido Teste</button>
                        <button class="btn" onclick="processPendingOrders()">‚ö° Processar Pendentes</button>
                    </div>
                </div>
                
                <!-- Tabela de Pedidos (Sempre Vis√≠vel) -->
                <div id="ordersTableContainer" class="orders-table-container">
                    <div class="table-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4>üìä Todos os Pedidos</h4>
                        <div class="table-controls">
                            <input type="text" id="searchOrders" placeholder="üîç Buscar pedidos..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; margin-right: 10px;">
                            <select id="filterStatus" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px;">
                                <option value="">Todos os Status</option>
                                <option value="pending">Pendente</option>
                                <option value="processing">Processando</option>
                                <option value="shipped">Enviado</option>
                                <option value="delivered">Entregue</option>
                            </select>
                        </div>
                    </div>
                    <div id="ordersTable" class="orders-table">
                        <!-- Tabela ser√° carregada aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sistema de Interface de Usu√°rios -->
        <div class="section">
            <h2>üë• Sistema de Interface de Usu√°rios</h2>
            <div class="dropshipping-controls">
                <button class="btn" onclick="loadUserStats()">üìä Estat√≠sticas</button>
                <button class="btn" onclick="loadUsersList()">üë• Listar Usu√°rios</button>
                <button class="btn" onclick="showCreateUserForm()">‚ûï Criar Usu√°rio</button>
                <button class="btn" onclick="loadUserPreferences()">‚öôÔ∏è Prefer√™ncias</button>
            </div>
            
            <div class="stats-grid" id="userStats">
                <div class="stat-card">
                    <h3 id="totalUsers">0</h3>
                    <p>Total de Usu√°rios</p>
                </div>
                <div class="stat-card">
                    <h3 id="activeUsers">0</h3>
                    <p>Usu√°rios Ativos</p>
                </div>
                <div class="stat-card">
                    <h3 id="newUsersToday">0</h3>
                    <p>Novos Hoje</p>
                </div>
                <div class="stat-card">
                    <h3 id="customerUsers">0</h3>
                    <p>Clientes</p>
                </div>
            </div>
            
            <!-- Formul√°rio de Cria√ß√£o de Usu√°rio -->
            <div id="createUserForm" style="display: none; margin-top: 20px;">
                <h3>‚ûï Criar Novo Usu√°rio</h3>
                <div class="alert-form">
                    <div class="form-group">
                        <label for="firstName">Nome:</label>
                        <input type="text" id="firstName" placeholder="Digite o nome">
                    </div>
                    <div class="form-group">
                        <label for="lastName">Sobrenome:</label>
                        <input type="text" id="lastName" placeholder="Digite o sobrenome">
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" placeholder="Digite o email">
                    </div>
                    <div class="form-group">
                        <label for="password">Senha:</label>
                        <input type="password" id="password" placeholder="Digite a senha">
                    </div>
                    <div class="form-group">
                        <label for="phone">Telefone:</label>
                        <input type="tel" id="phone" placeholder="Digite o telefone">
                    </div>
                    <div class="form-group">
                        <label for="role">Fun√ß√£o:</label>
                        <select id="role">
                            <option value="customer">Cliente</option>
                            <option value="admin">Administrador</option>
                            <option value="moderator">Moderador</option>
                            <option value="supplier">Fornecedor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="currency">Moeda:</label>
                        <select id="currency">
                            <option value="BRL">Real Brasileiro (BRL)</option>
                            <option value="USD">D√≥lar Americano (USD)</option>
                            <option value="EUR">Euro (EUR)</option>
                            <option value="GBP">Libra Esterlina (GBP)</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="createUser()">‚úÖ Criar Usu√°rio</button>
                <button class="btn btn-secondary" onclick="hideCreateUserForm()">‚ùå Cancelar</button>
            </div>
            
            <!-- Lista de Usu√°rios -->
            <div id="usersList" style="margin-top: 20px;">
                <h3>üë• Lista de Usu√°rios</h3>
                <div id="usersContainer" class="loading">
                    Clique em "Listar Usu√°rios" para carregar a lista
                </div>
            </div>
            
            <!-- Prefer√™ncias de Usu√°rio -->
            <div id="userPreferences" style="display: none; margin-top: 20px;">
                <h3>‚öôÔ∏è Prefer√™ncias do Usu√°rio</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4>üîî Notifica√ß√µes</h4>
                        <div style="margin-top: 10px;">
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="emailNotifications" checked style="margin-right: 10px;">
                                Notifica√ß√µes por Email
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="smsNotifications" style="margin-right: 10px;">
                                Notifica√ß√µes por SMS
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="pushNotifications" checked style="margin-right: 10px;">
                                Notifica√ß√µes Push
                            </label>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4>üîí Privacidade</h4>
                        <div style="margin-top: 10px;">
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="showEmail" style="margin-right: 10px;">
                                Mostrar Email
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="showPhone" style="margin-right: 10px;">
                                Mostrar Telefone
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="showLocation" style="margin-right: 10px;">
                                Mostrar Localiza√ß√£o
                            </label>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4>üåç Localiza√ß√£o</h4>
                        <div class="form-group" style="margin-top: 10px;">
                            <label for="timezone">Fuso Hor√°rio:</label>
                            <select id="timezone">
                                <option value="America/Sao_Paulo">S√£o Paulo (GMT-3)</option>
                                <option value="America/New_York">Nova York (GMT-5)</option>
                                <option value="Europe/London">Londres (GMT+0)</option>
                                <option value="Europe/Paris">Paris (GMT+1)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="language">Idioma:</label>
                            <select id="language">
                                <option value="pt-BR">Portugu√™s (Brasil)</option>
                                <option value="en-US">English (US)</option>
                                <option value="es-ES">Espa√±ol</option>
                                <option value="fr-FR">Fran√ßais</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="saveUserPreferences()" style="margin-top: 20px;">üíæ Salvar Prefer√™ncias</button>
                <button class="btn btn-secondary" onclick="hideUserPreferences()">‚ùå Fechar</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        // Fun√ß√£o para fazer requisi√ß√µes
        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Erro na requisi√ß√£o:', error);
                throw error;
            }
        }

        // Carregar estat√≠sticas
        async function loadStats() {
            try {
                const data = await apiRequest('/dashboard?action=stats');
                
                document.getElementById('totalProducts').textContent = data.data.total_products;
                document.getElementById('totalAlerts').textContent = data.data.total_alerts;
                document.getElementById('productsToday').textContent = data.data.products_today;
                document.getElementById('alertsToday').textContent = data.data.alerts_today;
                
            } catch (error) {
                document.getElementById('statsGrid').innerHTML = 
                    `<div class="error">Erro ao carregar estat√≠sticas: ${error.message}</div>`;
            }
        }


        // Carregar hist√≥rico de vendas
        async function loadSalesHistory() {
            const salesDiv = document.getElementById('salesHistory');
            salesDiv.innerHTML = '<div class="loading">Carregando hist√≥rico de vendas...</div>';
            
            try {
                // Dados de vendas simulados (baseados no gr√°fico fornecido)
                const salesData = {
                    months: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    values: [4300, 4000, 4500, 2600, 5000, 4500, 6000, 3200, 3800, 3500, 5300, 1800]
                };
                
                const maxValue = Math.max(...salesData.values);
                const totalSales = salesData.values.reduce((sum, val) => sum + val, 0);
                const averageSales = Math.round(totalSales / salesData.values.length);
                const bestMonth = salesData.months[salesData.values.indexOf(maxValue)];
                const worstMonth = salesData.months[salesData.values.indexOf(Math.min(...salesData.values))];
                
                // Criar HTML do gr√°fico
                let chartHTML = `
                    <div class="sales-chart">
                        <h3>Hist√≥rico de Vendas em 2025</h3>
                        <div class="chart-container">
                            <div class="chart-values">
                                ${salesData.values.map(val => `<div class="chart-value">${val}</div>`).join('')}
                            </div>
                            <div class="chart-bars">
                                ${salesData.values.map((val, index) => {
                                    const height = (val / maxValue) * 100;
                                    return `<div class="chart-bar" style="height: ${height}%" title="${salesData.months[index]}: ${val} vendas"></div>`;
                                }).join('')}
                            </div>
                            <div class="chart-labels">
                                ${salesData.months.map(month => `<div class="chart-label">${month}</div>`).join('')}
                            </div>
                        </div>
                        
                        <div class="sales-stats">
                            <div class="sales-stat">
                                <h4>Total de Vendas</h4>
                                <div class="value">${totalSales.toLocaleString()}</div>
                            </div>
                            <div class="sales-stat">
                                <h4>M√©dia Mensal</h4>
                                <div class="value">${averageSales.toLocaleString()}</div>
                            </div>
                            <div class="sales-stat">
                                <h4>Melhor M√™s</h4>
                                <div class="value">${bestMonth}</div>
                            </div>
                            <div class="sales-stat">
                                <h4>Pior M√™s</h4>
                                <div class="value">${worstMonth}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                salesDiv.innerHTML = chartHTML;
                
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico de vendas:', error);
                salesDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Erro ao carregar hist√≥rico de vendas</strong>
                        <br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }




        // Carregar alertas ativos (agora mostra pre√ßos reais dos produtos)
        async function loadActiveAlerts() {
            const alertsDiv = document.getElementById('activeAlerts');
            alertsDiv.innerHTML = '<div class="loading">üîÑ Atualizando pre√ßos dos produtos...</div>';
            
            try {
                // Obter dados do scraper AliExpress
                let scrapedData = null;
                let scraperResponseData = null;
                try {
                    const scraperResponse = await fetch('/api/aliexpress-scraper/data');
                    scraperResponseData = await scraperResponse.json();
                    if (scraperResponseData.success && scraperResponseData.data && scraperResponseData.data.length > 0) {
                        scrapedData = scraperResponseData.data;
                    }
                } catch (scraperError) {
                    console.log('Erro ao obter dados do scraper:', scraperError.message);
                }
                
                if (!scrapedData) {
                    alertsDiv.innerHTML = '<p>‚ùå Nenhum produto encontrado no scraper. Ative o scraper no openservice.aliexpress.com</p>';
                    return;
                }
                
               // Usar apenas dados do scraper (filtrar apenas AliExpress)
               const productsToShow = scrapedData.filter(p => p.id && p.id.startsWith('aliexpress_'));
                
                let html = '<table class="data-table"><thead><tr><th>Produto</th><th>Pre√ßo Atual</th><th>Moeda</th><th>Estoque</th><th>Rating</th><th>Reviews</th><th>Loja</th><th>√öltima Atualiza√ß√£o</th></tr></thead><tbody>';
                
                productsToShow.forEach(product => {
                    const title = product.title || 'Produto sem nome';
                    const price = product.price || 'N/A';
                    const currency = product.currency || 'USD';
                    const stock = product.stock || 'N/A';
                    const rating = product.rating || 'N/A';
                    const reviews = product.reviews || 'N/A';
                    const seller = product.seller?.name || 'N/A';
                    const lastUpdate = product.scrapedAt ? new Date(product.scrapedAt).toLocaleString() : new Date().toLocaleString();
                    
                    html += `
                        <tr>
                            <td><strong>${title}</strong></td>
                            <td><span class="price-current">$${price}</span></td>
                            <td><span class="currency">${currency}</span></td>
                            <td><span class="stock">${stock}</span></td>
                            <td><span class="rating">‚≠ê ${rating}</span></td>
                            <td><span class="reviews">${reviews}</span></td>
                            <td><span class="seller">${seller}</span></td>
                            <td><span class="timestamp">${lastUpdate}</span></td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                
                // Adicionar resumo
                const totalProducts = productsToShow.length;
                const avgPrice = productsToShow.reduce((sum, p) => sum + (parseFloat(p.price) || 0), 0) / totalProducts;
                
                html += `
                    <div class="price-summary" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h4>üìä Resumo dos Pre√ßos</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                            <div><strong>Total de Produtos:</strong> ${totalProducts}</div>
                            <div><strong>Pre√ßo M√©dio:</strong> $${avgPrice.toFixed(2)}</div>
                            <div><strong>Fonte:</strong> üï∑Ô∏è Scraper AliExpress (Amazon pendente)</div>
                            <div><strong>√öltima Atualiza√ß√£o:</strong> ${scraperResponseData.scrapedAt ? new Date(scraperResponseData.scrapedAt).toLocaleString() : 'N/A'}</div>
                        </div>
                    </div>
                `;
                
                alertsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Erro ao carregar pre√ßos dos produtos:', error);
                alertsDiv.innerHTML = '<p>‚ùå Erro ao carregar pre√ßos dos produtos.</p>';
            }
        }

        // Carregar an√°lise de tend√™ncias
        async function loadTrendsAnalysis() {
            const trendsDiv = document.getElementById('trendsAnalysis');
            trendsDiv.innerHTML = '<div class="loading">Carregando an√°lise...</div>';
            
            try {
                const data = await apiRequest('/analytics?action=performance');
                
                trendsDiv.innerHTML = `
                    <div class="success">
                        <h4>üìä Resumo do Sistema</h4>
                        <p><strong>Total de Produtos:</strong> ${data.data.total_products}</p>
                        <p><strong>Produtos Hoje:</strong> ${data.data.products_today}</p>
                        <p><strong>Alertas Ativos:</strong> ${data.data.active_monitoring_alerts}</p>
                        <p><strong>Notifica√ß√µes:</strong> ${data.data.total_notifications}</p>
                        <p><strong>Status:</strong> ${data.data.system_status}</p>
                    </div>
                `;
                
            } catch (error) {
                trendsDiv.innerHTML = `<div class="error">Erro ao carregar an√°lise: ${error.message}</div>`;
            }
        }

        // Fun√ß√µes de Dropshipping

        async function loadDropshippingStatus() {
            try {
                const response = await fetch('/api/dropshipping/status');
                const data = await response.json();
                
                document.getElementById('dropshippingStatus').textContent = data.running ? 'Online' : 'Offline';
                document.getElementById('dropshippingProducts').textContent = data.products || 0;
                document.getElementById('aliexpressProducts').textContent = data.aliexpress_products || 0;
                document.getElementById('amazonProducts').textContent = data.amazon_products || 0;
                document.getElementById('inStockProducts').textContent = data.in_stock || 0;
                document.getElementById('dropshippingOrders').textContent = data.orders || 0;
                
                // Atualizar cor do status
                const statusElement = document.getElementById('dropshippingStatus');
                statusElement.style.color = data.running ? '#28a745' : '#dc3545';
                
            } catch (error) {
                console.error('Erro ao carregar status do dropshipping:', error);
            }
        }

        async function loadInventoryStatus() {
            try {
                const response = await fetch('/api/dropshipping/inventory');
                const data = await response.json();
                
                const inventoryDiv = document.getElementById('inventoryStatus');
                inventoryDiv.innerHTML = `
                    <div class="success">
                        <p><strong>Total de Produtos:</strong> ${data.total}</p>
                        <p><strong>Em Estoque:</strong> ${data.available}</p>
                        <p><strong>Estoque Baixo:</strong> ${data.lowStock}</p>
                        <p><strong>Sem Estoque:</strong> ${data.outOfStock}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('inventoryStatus').innerHTML = `<div class="error">Erro: ${error.message}</div>`;
            }
        }

        async function loadStockAlerts() {
            try {
                const response = await fetch('/api/dropshipping/alerts');
                const alerts = await response.json();
                
                const alertsDiv = document.getElementById('stockAlerts');
                
                if (alerts.length === 0) {
                    alertsDiv.innerHTML = '<p>Nenhum alerta de estoque ativo.</p>';
                    return;
                }
                
                let html = '<table class="data-table"><thead><tr><th>Produto</th><th>Tipo</th><th>Estoque</th><th>Data</th></tr></thead><tbody>';
                
                alerts.slice(0, 10).forEach(alert => {
                    html += `
                        <tr>
                            <td>${alert.productName}</td>
                            <td>${alert.type}</td>
                            <td>${alert.stock}</td>
                            <td>${new Date(alert.timestamp).toLocaleString()}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                alertsDiv.innerHTML = html;
                
            } catch (error) {
                document.getElementById('stockAlerts').innerHTML = `<div class="error">Erro: ${error.message}</div>`;
            }
        }

        // Atualizar tudo
        // Vari√°vel para armazenar os cards est√°ticos dos produtos
        let staticProductCards = null;
        let lastProductUpdate = null;


        // Carregar produtos reais dos fornecedores
        async function loadRealProducts(platform = null) {
            const container = document.getElementById('realProductsContainer');
            
            console.log('üîÑ Carregando produtos do scraper...');
            container.innerHTML = '<div class="loading">üîÑ Carregando produtos do scraper...</div>';
            
            try {
                // Obter dados do SCRAPER (√∫nica fonte de dados)
                const scraperResponse = await fetch('/api/aliexpress-scraper/data');
                const scraperResult = await scraperResponse.json();
                
                console.log('üìä Resposta do scraper:', scraperResult);
                
                if (scraperResult.success && scraperResult.data && scraperResult.data.length > 0) {
                    const scraperData = scraperResult.data;
                    console.log('‚úÖ Dados do SCRAPER obtidos:', scraperData.length, 'produtos');
                    
                    let html = '<div class="products-grid">';
                    console.log('üèóÔ∏è Criando cards com dados do scraper...');
                    
                    // Usar apenas dados do scraper (apenas AliExpress por enquanto)
                    scraperData.forEach(product => {
                        // Filtrar apenas produtos AliExpress (Amazon pendente)
                        if (product.id && product.id.startsWith('amazon_')) {
                            return; // Pular produtos Amazon
                        }
                        
                        const platformIcon = 'üõí';
                        const platformName = 'AliExpress';
                        
                        const displayTitle = product.title || 'Produto sem nome';
                        const displayPrice = `$${product.price} ${product.currency || 'USD'}`;
                        const displayRating = product.rating || 'N/A';
                        const displayStock = product.stock || 'Em Estoque';
                        const displayImage = product.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM2Yzc1N2QiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZW0gTsOjbyBFbmNvbnRyYWRhPC90ZXh0Pjwvc3ZnPg==';
                        const productId = product.id || 'N/A';
                        const reviews = product.reviews || 'N/A';
                        const supplier = product.seller?.name || 'N/A';
                        const skus = product.skus || 'N/A';
                        const productUrl = product.url || '#';
                        
                        html += `
                            <div class="product-card scraped-data">
                                <div class="product-image">
                                    <img src="${displayImage}" alt="${displayTitle}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM2Yzc1N2QiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZW0gTsOjbyBFbmNvbnRyYWRhPC90ZXh0Pjwvc3ZnPg=='">
                                </div>
                                <div class="product-header">
                                    <span class="platform-badge aliexpress">${platformIcon} ${platformName}</span>
                                    <span class="price">${displayPrice}</span>
                                </div>
                                <div class="product-name">${displayTitle}</div>
                                <div class="product-details">
                                    <span class="rating">‚≠ê ${displayRating}</span>
                                    <span class="stock">‚úÖ ${displayStock}</span>
                                </div>
                                <div class="product-info">
                                    <small>ID: ${productId}</small>
                                    <small>Reviews: ${reviews}</small>
                                    <small>Loja: ${supplier}</small>
                                    <small>SKUs: ${skus}</small>
                                    ${product.category ? `<small>Categoria: ${product.category}</small>` : ''}
                                    ${product.tags ? `<small>Tags: ${product.tags.join(', ')}</small>` : ''}
                                    ${product.shipping ? `<small>Frete: ${product.shipping.free ? 'Gr√°tis' : 'Pago'} (${product.shipping.estimatedDays} dias)</small>` : ''}
                                    ${product.apiUsed ? `<small>API: ${product.apiUsed}</small>` : ''}
                                </div>
                                <div class="product-actions">
                                    <a href="${productUrl}" target="_blank" class="btn btn-primary">Ver Produto</a>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    
                    // Adicionar indicador de fonte dos dados h√≠brida
                    const aliexpressCount = scraperData.length;
                    const dataSource = `
                        <div class="data-source-indicator hybrid-indicator">
                            <div class="hybrid-header">üìä Sistema H√≠brido: Fornecedores + Scraper</div>
                            <div class="hybrid-breakdown">
                                <div class="fornecedores-data">üè™ Fornecedores: Nomes, Links, Imagens</div>
                                <div class="scraper-data">üï∑Ô∏è Scraper: Pre√ßos, Lojas, SKUs, Estoque</div>
                            </div>
                            <div class="hybrid-stats">${aliexpressCount} produtos AliExpress (Amazon pendente)</div>
                        </div>
                    `;
                    
                    console.log('üé® HTML dos cards criado, inserindo no container...');
                    container.innerHTML = dataSource + html;
                    staticProductCards = dataSource + html; // Armazenar os cards est√°ticos
                    lastProductUpdate = new Date().toISOString();
                    console.log('‚úÖ Cards de produtos criados com dados do scraper');
                    
                } else {
                    container.innerHTML = '<div class="error">‚ùå Nenhum produto encontrado no scraper. Ative o scraper no openservice.aliexpress.com</div>';
                }
                
            } catch (error) {
                container.innerHTML = `<div class="error">Erro ao carregar produtos: ${error.message}</div>`;
            } finally {
                container.classList.remove('loading');
            }
        }
        
        
        // Ver produto
        
        // Abrir URL do fornecedor
        function openSupplierUrl(url) {
            window.open(url, '_blank');
        }
        
        

        async function refreshAll() {
            await Promise.all([
                loadStats(),
                loadSalesHistory(),
                loadActiveAlerts(), // Agora mostra pre√ßos reais dos produtos
                loadTrendsAnalysis(),
                loadDropshippingStatus(),
                loadRealProducts(), // Adicionar atualiza√ß√£o dos produtos reais
                loadInventoryStatus(),
                loadStockAlerts()
            ]);
        }

        // ===== FUN√á√ïES DO SISTEMA DE PEDIDOS =====
        
        let allOrders = [];
        
        // Carregar pedidos automaticamente
        async function loadOrders() {
            try {
                const response = await fetch('/api/orders?action=list');
                const data = await response.json();
                
                if (data.success && data.data) {
                    allOrders = data.data;
                    renderOrdersTable();
                    simulateAutomaticStatusUpdates(); // Iniciar simula√ß√£o de atualiza√ß√µes autom√°ticas
                } else {
                    console.log('Nenhum pedido encontrado');
                    allOrders = [];
                    renderOrdersTable();
                }
            } catch (error) {
                console.error('Erro ao carregar pedidos:', error);
                allOrders = [];
                renderOrdersTable();
            }
        }
        
        
        // Renderizar tabela completa
        function renderOrdersTable() {
            const container = document.getElementById('ordersTable');
            
            if (allOrders.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nenhum pedido encontrado</p>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Cliente</th>
                            <th>Email</th>
                            <th>Produto</th>
                            <th>Cor</th>
                            <th>Tamanho</th>
                            <th>Qtd</th>
                            <th>Pre√ßo</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Fornecedor</th>
                            <th>Tracking</th>
                            <th>Data</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            allOrders.forEach(order => {
                const items = order.products || order.items || [];
                const statusColor = getStatusColor(order.status);
                const statusIcon = getStatusIcon(order.status);
                
                if (items.length > 0) {
                    items.forEach((item, index) => {
                        const isFirstRow = index === 0;
                        const rowSpan = items.length > 1 ? `rowspan="${items.length}"` : '';
                        
                        html += `
                            <tr>
                                ${isFirstRow ? `<td ${rowSpan}>${order.id.split('_')[1] || order.id}</td>` : ''}
                                ${isFirstRow ? `<td ${rowSpan}>${order.customer?.name || 'N/A'}</td>` : ''}
                                ${isFirstRow ? `<td ${rowSpan}>${order.customer?.email || 'N/A'}</td>` : ''}
                                <td>${item.name || 'N/A'}</td>
                                <td>${item.color || 'N/A'}</td>
                                <td>${item.size || 'N/A'}</td>
                                <td>${item.quantity || 1}</td>
                                <td>R$ ${item.price || '0.00'}</td>
                                ${isFirstRow ? `<td ${rowSpan}>R$ ${order.total || '0.00'}</td>` : ''}
                                ${isFirstRow ? `<td ${rowSpan}>
                                    <span class="status-badge ${getStatusColor(order.status)}">${getStatusIcon(order.status)} ${order.status}</span>
                                </td>` : ''}
                                ${isFirstRow ? `<td ${rowSpan}>${order.supplier || 'N/A'}</td>` : ''}
                                ${isFirstRow ? `<td ${rowSpan}>${order.tracking?.trackingNumber || 'N/A'}</td>` : ''}
                                ${isFirstRow ? `<td ${rowSpan}>${new Date(order.createdAt).toLocaleDateString()}</td>` : ''}
                                ${isFirstRow ? `<td ${rowSpan}>
                                    <button class="btn-micro primary" onclick="viewOrderDetails('${order.id}')">Ver</button>
                                    <button class="btn-micro secondary" onclick="processOrderToAliExpress('${order.id}')">Processar</button>
                                </td>` : ''}
                            </tr>
                        `;
                    });
                } else {
                    // Pedido sem itens
                    html += `
                        <tr>
                            <td>${order.id.split('_')[1] || order.id}</td>
                            <td>${order.customer?.name || 'N/A'}</td>
                            <td>${order.customer?.email || 'N/A'}</td>
                            <td colspan="6" style="text-align: center; color: #999;">Sem produtos</td>
                            <td>R$ ${order.total || '0.00'}</td>
                            <td>
                                <span class="status-badge ${getStatusColor(order.status)}">${getStatusIcon(order.status)} ${order.status}</span>
                            </td>
                            <td>${order.supplier || 'N/A'}</td>
                            <td>${order.tracking?.trackingNumber || 'N/A'}</td>
                            <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                            <td>
                                <button class="btn-micro primary" onclick="viewOrderDetails('${order.id}')">Ver</button>
                                <button class="btn-micro secondary" onclick="processOrderToAliExpress('${order.id}')">Processar</button>
                            </td>
                        </tr>
                    `;
                }
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Campos n√£o s√£o mais edit√°veis na tabela - apenas no popup
        }
        
        
        
        // Atualizar status automaticamente baseado em eventos reais
        async function updateOrderStatusAutomatically(orderId, newStatus, reason = '') {
            try {
                const response = await fetch(`/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        status: newStatus,
                        notes: reason ? `Status atualizado automaticamente: ${reason}` : 'Status atualizado automaticamente'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    console.log(`‚úÖ Status do pedido ${orderId} atualizado para: ${newStatus} (${reason})`);
                    loadOrders(); // Recarregar dados
                }
            } catch (error) {
                console.error('Erro ao atualizar status automaticamente:', error);
            }
        }
        
        // Simular atualiza√ß√µes autom√°ticas de status (em produ√ß√£o, isso viria de webhooks/APIs)
        function simulateAutomaticStatusUpdates() {
            // Simular que alguns pedidos mudaram de status
            setTimeout(() => {
                // Exemplo: Pedido processado ap√≥s 30 segundos
                const orders = allOrders.filter(order => order.status === 'pending');
                if (orders.length > 0) {
                    const randomOrder = orders[0];
                    updateOrderStatusAutomatically(randomOrder.id, 'processing', 'Pagamento confirmado pelo gateway');
                }
            }, 30000);
            
            setTimeout(() => {
                // Exemplo: Pedido enviado ap√≥s 2 minutos
                const orders = allOrders.filter(order => order.status === 'processing');
                if (orders.length > 0) {
                    const randomOrder = orders[0];
                    updateOrderStatusAutomatically(randomOrder.id, 'shipped', 'Produto enviado pelo fornecedor');
                }
            }, 120000);
        }
        
        // Salvar edi√ß√µes do pedido
        async function saveOrderEdits(orderId) {
            try {
                const editableInputs = document.querySelectorAll('.editable-input');
                const updates = {};
                
                editableInputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    const value = input.value;
                    updates[field] = value;
                });
                
                const response = await fetch(`/api/orders?action=update_fields&id=${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updates)
                });
                
                const result = await response.json();
                if (result.success) {
                    showMessage('‚úÖ Edi√ß√µes salvas com sucesso!', 'success');
                    loadOrders(); // Recarregar dados
                } else {
                    showMessage('‚ùå Erro ao salvar edi√ß√µes: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar edi√ß√µes:', error);
                showMessage('‚ùå Erro ao salvar edi√ß√µes: ' + error.message, 'error');
            }
        }
        
        // Enviar para fornecedores
        async function sendToSuppliers(orderId) {
            try {
                const order = allOrders.find(o => o.id === orderId);
                if (!order) {
                    showMessage('‚ùå Pedido n√£o encontrado', 'error');
                    return;
                }
                
                // Simular envio para fornecedores
                showMessage('üì§ Enviando dados para fornecedores...', 'info');
                
                const response = await fetch(`/api/orders?action=send_to_suppliers&id=${orderId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        supplier: 'aliexpress',
                        products: order.products,
                        customer: order.customer,
                        shipping: order.shipping
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    showMessage('‚úÖ Dados enviados para fornecedores com sucesso!', 'success');
                    updateOrderStatusAutomatically(orderId, 'processing', 'Dados enviados para fornecedores');
                } else {
                    showMessage('‚ùå Erro ao enviar para fornecedores: ' + result.error, 'error');
                }
                } catch (error) {
                console.error('Erro ao enviar para fornecedores:', error);
                showMessage('‚ùå Erro ao enviar para fornecedores: ' + error.message, 'error');
            }
        }
        
        // Toggle do Sistema de Dropshipping (Online/Offline) com Sincroniza√ß√£o
        let dropshippingSystemOnline = false;
        
        async function toggleDropshippingSystem() {
            try {
                dropshippingSystemOnline = !dropshippingSystemOnline;
                const statusText = dropshippingSystemOnline ? 'Online' : 'Offline';
                const statusColor = dropshippingSystemOnline ? '#28a745' : '#dc3545';
                
                // Atualizar status no card
                const statusElement = document.getElementById('dropshippingStatus');
                if (statusElement) {
                    statusElement.textContent = statusText;
                    statusElement.style.color = statusColor;
                }
                
                if (dropshippingSystemOnline) {
                    showMessage('üéõÔ∏è Sistema Online!<br>üîÑ Sincronizando com AliExpress...', 'info');
                    
                    // Sincronizar automaticamente quando ativar (sem aguardar)
                    syncWithAliExpress().catch(error => {
                        console.error('Erro na sincroniza√ß√£o (n√£o cr√≠tico):', error);
                        // N√£o desativar o sistema por erro de sincroniza√ß√£o
                        showMessage('‚ö†Ô∏è Sistema Online, mas erro na sincroniza√ß√£o. Verifique o scraper.', 'warning');
                    });
                } else {
                    showMessage('üéõÔ∏è Sistema de Dropshipping: <strong>Offline</strong>', 'error');
                }
                
            } catch (error) {
                console.error('Erro ao alternar sistema:', error);
                showMessage('‚ùå Erro ao alternar sistema: ' + error.message, 'error');
                // Reverter o estado em caso de erro cr√≠tico
                dropshippingSystemOnline = !dropshippingSystemOnline;
                const statusElement = document.getElementById('dropshippingStatus');
                if (statusElement) {
                    statusElement.textContent = 'Offline';
                    statusElement.style.color = '#dc3545';
                }
            }
        }
        
        // Sincronizar com AliExpress (integrado no sistema) - SIMPLIFICADO
        async function syncWithAliExpress() {
            try {
                console.log('üîÑ Iniciando sincroniza√ß√£o com AliExpress...');
                
                // Ativar o callback
                const activateResponse = await fetch('/api/aliexpress/callback/activate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        timestamp: new Date().toISOString(),
                        source: 'system-activation',
                        data: {
                            user: 'admin',
                            action: 'system_activation_sync',
                            note: 'Sincroniza√ß√£o autom√°tica ao ativar sistema'
                        }
                    })
                });
                
                const activateResult = await activateResponse.json();
                console.log('üì° Resposta do callback:', activateResult);
                
                if (activateResult.success) {
                    console.log('‚úÖ Callback ativado com sucesso');
                    
                    // Buscar produtos imediatamente (sem setTimeout)
                    console.log('üì¶ Buscando dados do scraper...');
                    const scraperResponse = await fetch('/api/aliexpress-scraper/data');
                    const scraperData = await scraperResponse.json();
                    
                    console.log('üìä Dados do scraper:', scraperData);
                    
                    if (scraperData.success && scraperData.data && scraperData.data.length > 0) {
                        showMessage(`‚úÖ Sincroniza√ß√£o conclu√≠da!<br>üì¶ ${scraperData.data.length} produtos encontrados`, 'success');
                        loadRealProducts('aliexpress');
                        refreshAll();
                    } else {
                        showMessage('‚ö†Ô∏è Sistema ativado, mas nenhum produto encontrado.<br>üí° Ative o scraper no openservice.aliexpress.com primeiro!', 'error');
                        loadRealProducts('aliexpress');
                    }
                    
                } else {
                    console.error('‚ùå Erro no callback:', activateResult.error);
                    showMessage('‚ùå Erro ao ativar sistema: ' + activateResult.error, 'error');
                }
            } catch (error) {
                console.error('‚ùå Erro na sincroniza√ß√£o:', error);
                showMessage('‚ùå Erro na sincroniza√ß√£o: ' + error.message, 'error');
            }
        }
        
        // Criar pedido de teste
        async function createTestOrder() {
            try {
                const testOrder = {
                    customer: {
                        name: 'Cliente Teste',
                        email: 'teste@exemplo.com',
                        phone: '+55 11 99999-9999'
                    },
                    items: [
                        {
                            productId: '100500106836560',
                            name: 'Detachable Sofa Cover Bean Bag Cover',
                            price: 45.99,
                            quantity: 1,
                            sku: 'Green-XL',
                            supplier: 'aliexpress'
                        }
                    ],
                    total: 45.99,
                    supplier: 'aliexpress',
                    shipping: {
                        address: 'Rua Teste, 123',
                        city: 'S√£o Paulo',
                        zipCode: '01234-567'
                    }
                };
                
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testOrder)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('Pedido de teste criado com sucesso! ID: ' + result.data.id, 'success');
                    loadOrders(); // Recarregar lista
                } else {
                    throw new Error(result.message || 'Erro ao criar pedido');
                }
            } catch (error) {
                console.error('Erro ao criar pedido de teste:', error);
                showMessage('Erro ao criar pedido de teste: ' + error.message, 'error');
            }
        }
        
        // Processar pedidos pendentes
        async function processPendingOrders() {
            try {
                const response = await fetch('/api/orders?action=process_pending', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(`${result.data.processed} pedidos processados com sucesso!`, 'success');
                    loadOrders(); // Recarregar lista
                } else {
                    throw new Error(result.message || 'Erro ao processar pedidos');
                }
            } catch (error) {
                console.error('Erro ao processar pedidos:', error);
                showMessage('Erro ao processar pedidos: ' + error.message, 'error');
            }
        }
        
        // Ver detalhes do pedido
        async function viewOrderDetails(orderId) {
            try {
                // Buscar pedido na lista local primeiro
                const order = allOrders.find(o => o.id === orderId);
                
                if (order) {
                    showOrderDetailsModal(order);
                } else {
                    // Se n√£o encontrar localmente, buscar na API
                    const response = await fetch(`/api/orders?action=get&id=${orderId}`);
                const data = await response.json();
                
                    if (data.success && data.data) {
                        showOrderDetailsModal(data.data);
                    } else {
                        showMessage('Pedido n√£o encontrado', 'error');
                    }
                }
            } catch (error) {
                console.error('Erro ao obter detalhes do pedido:', error);
                showMessage('Erro ao obter detalhes do pedido: ' + error.message, 'error');
            }
        }
        
        // Editar pedido
        function editOrder(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (order) {
                showOrderDetailsModal(order, true); // true = modo edi√ß√£o
            }
        }
        
        // Mostrar modal de detalhes do pedido
        function showOrderDetailsModal(order, isEditMode = false) {
            // Criar overlay
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            `;
            
            // Criar modal
            const modal = document.createElement('div');
            modal.className = 'order-details-modal';
            modal.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 30px;
                max-width: 800px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;
            
            modal.innerHTML = `
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #eee;">
                    <h3 style="margin: 0; color: #333; font-size: 24px;">üì¶ Pedido #${order.id}</h3>
                    <button onclick="closeOrderModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
                                </div>
                
                <div class="modal-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <!-- Informa√ß√µes do Cliente -->
                    <div class="customer-section">
                        <h4 style="color: #007bff; margin-bottom: 15px; font-size: 18px;">üë§ Informa√ß√µes do Cliente</h4>
                        <div class="info-grid" style="display: grid; gap: 10px;">
                            <div class="info-item">
                                <strong>Nome:</strong> 
                                <input type="text" class="editable-input" data-field="customer.name" value="${order.customer?.name || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                                </div>
                            <div class="info-item">
                                <strong>Email:</strong> 
                                <input type="email" class="editable-input" data-field="customer.email" value="${order.customer?.email || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                                </div>
                            <div class="info-item">
                                <strong>Telefone:</strong> 
                                <input type="tel" class="editable-input" data-field="customer.phone" value="${order.customer?.phone || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                                </div>
                            </div>
                        
                        <h4 style="color: #007bff; margin: 20px 0 15px 0; font-size: 18px;">üè† Endere√ßo de Entrega</h4>
                        <div class="address-info" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff;">
                            <div style="margin-bottom: 10px;">
                                <strong>Endere√ßo:</strong> 
                                <input type="text" class="editable-input" data-field="shipping.address" value="${order.shipping?.address || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>Cidade:</strong> 
                                <input type="text" class="editable-input" data-field="shipping.city" value="${order.shipping?.city || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                            </div>
                            <div>
                                <strong>CEP:</strong> 
                                <input type="text" class="editable-input" data-field="shipping.zipCode" value="${order.shipping?.zipCode || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informa√ß√µes do Pedido -->
                    <div class="order-section">
                        <h4 style="color: #28a745; margin-bottom: 15px; font-size: 18px;">üìã Detalhes do Pedido</h4>
                        <div class="info-grid" style="display: grid; gap: 10px;">
                            <div class="info-item">
                                <strong>Status:</strong> 
                                <span class="status-badge ${getStatusColor(order.status)}">${getStatusIcon(order.status)} ${order.status}</span>
                                </div>
                            <div class="info-item">
                                <strong>Total:</strong> R$ ${order.total || '0.00'}
                                </div>
                            <div class="info-item">
                                <strong>Fornecedor:</strong> ${order.supplier || 'N/A'}
                                </div>
                            <div class="info-item">
                                <strong>Data:</strong> ${new Date(order.createdAt).toLocaleString()}
                                </div>
                            <div class="info-item">
                                <strong>Tracking:</strong> ${order.tracking?.trackingNumber || 'N/A'}
                            </div>
                            </div>
                    </div>
                </div>
                
                <!-- Produtos do Pedido -->
                <div class="products-section" style="margin-top: 30px;">
                    <h4 style="color: #ff6b35; margin-bottom: 15px; font-size: 18px;">üõçÔ∏è Produtos do Pedido</h4>
                    <div class="products-grid" style="display: grid; gap: 15px;">
                        ${order.items?.map(item => `
                            <div class="product-item" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #ff6b35;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div class="product-info">
                                        <div style="font-weight: bold; margin-bottom: 8px; color: #333;">${item.name}</div>
                                        <div style="margin-bottom: 5px;"><strong>SKU:</strong> ${item.sku}</div>
                                        <div style="margin-bottom: 5px;"><strong>Quantidade:</strong> ${item.quantity}</div>
                                        <div style="margin-bottom: 5px;"><strong>Pre√ßo Unit√°rio:</strong> R$ ${item.price}</div>
                                        <div style="margin-bottom: 5px;"><strong>Pre√ßo Total:</strong> R$ ${(item.price * item.quantity).toFixed(2)}</div>
                                </div>
                                    <div class="aliexpress-info" style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #ddd;">
                                        <h5 style="margin: 0 0 10px 0; color: #ff6b35;">üõí Para AliExpress:</h5>
                                        <div style="font-size: 14px;">
                                            <div><strong>Product ID:</strong> ${item.productId}</div>
                                            <div><strong>SKU Equivalente:</strong> ${item.sku}</div>
                                            <div><strong>Cor/Tamanho:</strong> ${item.sku}</div>
                                            <div><strong>Quantidade:</strong> ${item.quantity}</div>
                                </div>
                                </div>
                            </div>
                            </div>
                        `).join('') || '<p>Nenhum item encontrado</p>'}
                    </div>
                </div>
                
                <!-- A√ß√µes -->
                <div class="modal-actions" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; display: flex; gap: 15px; justify-content: flex-end;">
                    <button onclick="saveOrderEdits('${order.id}')" class="btn-save" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        üíæ Salvar Edi√ß√µes
                    </button>
                    <button onclick="processOrderToAliExpress('${order.id}')" class="btn-process" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        üõí Processar no AliExpress
                    </button>
                    <button onclick="sendToSuppliers('${order.id}')" class="btn-send" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        üì§ Enviar para Fornecedores
                    </button>
                    <button onclick="closeOrderModal()" class="btn-close" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        ‚ùå Fechar
                    </button>
                            </div>
                        `;
            
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // Fechar ao clicar no overlay
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeOrderModal();
                }
            });
        }
        
        // Fechar modal
        function closeOrderModal() {
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Processar pedido no AliExpress
        async function processOrderToAliExpress(orderId) {
            try {
                showMessage('üõí Processando pedido no AliExpress...', 'info');
                
                const response = await fetch(`/api/orders?action=process_to_aliexpress&id=${orderId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('‚úÖ Pedido processado no AliExpress com sucesso!', 'success');
                    closeOrderModal();
                    loadOrders(); // Recarregar lista
                } else {
                    throw new Error(result.message || 'Erro ao processar pedido');
                }
            } catch (error) {
                console.error('Erro ao processar pedido no AliExpress:', error);
                showMessage('‚ùå Erro ao processar pedido: ' + error.message, 'error');
            }
        }
        
        // Atualizar status do pedido
        async function updateOrderStatus(orderId) {
            try {
                const response = await fetch(`/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'processing' })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('Status do pedido atualizado com sucesso!', 'success');
                    loadOrders(); // Recarregar lista
            } else {
                    throw new Error(result.message || 'Erro ao atualizar status');
                }
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                showMessage('Erro ao atualizar status: ' + error.message, 'error');
            }
        }
        
        // Fun√ß√µes auxiliares para status
        function getStatusColor(status) {
            switch (status) {
                case 'pending': return 'status-pending';
                case 'processing': return 'status-processing';
                case 'shipped': return 'status-shipped';
                case 'delivered': return 'status-delivered';
                case 'cancelled': return 'status-cancelled';
                default: return 'status-unknown';
            }
        }
        
        function getStatusIcon(status) {
            switch (status) {
                case 'pending': return '‚è≥';
                case 'processing': return '‚ö°';
                case 'shipped': return 'üöö';
                case 'delivered': return '‚úÖ';
                case 'cancelled': return '‚ùå';
                default: return '‚ùì';
            }
        }

        // ===== FUN√á√ïES DO SCRAPER =====
        
        
        
        // Fun√ß√£o para mostrar mensagens
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                max-width: 400px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                ${type === 'success' ? 'background: linear-gradient(135deg, #28a745 0%, #20c997 100%);' : ''}
                ${type === 'error' ? 'background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);' : ''}
                ${type === 'warning' ? 'background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);' : ''}
                ${type === 'info' ? 'background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);' : ''}
            `;
            
            document.body.appendChild(messageDiv);
            
            // Remover mensagem ap√≥s 5 segundos
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // ===== FUN√á√ïES DO SISTEMA DE USU√ÅRIOS =====
        
        // Carregar estat√≠sticas de usu√°rios
        async function loadUserStats() {
            try {
                const data = await apiRequest('/users/stats');
                
                if (data.success) {
                    document.getElementById('totalUsers').textContent = data.data.totalUsers;
                    document.getElementById('activeUsers').textContent = data.data.activeUsers;
                    document.getElementById('newUsersToday').textContent = data.data.newUsersToday;
                    document.getElementById('customerUsers').textContent = data.data.usersByRole.customer || 0;
                    
                    showMessage('Estat√≠sticas de usu√°rios carregadas!', 'success');
                }
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas de usu√°rios:', error);
                showMessage('Erro ao carregar estat√≠sticas de usu√°rios', 'error');
            }
        }
        
        // Carregar lista de usu√°rios
        async function loadUsersList() {
            try {
                const data = await apiRequest('/users/list');
                
                if (data.success) {
                    displayUsersList(data.data);
                    showMessage('Lista de usu√°rios carregada!', 'success');
                }
            } catch (error) {
                console.error('Erro ao carregar lista de usu√°rios:', error);
                showMessage('Erro ao carregar lista de usu√°rios', 'error');
            }
        }
        
        // Exibir lista de usu√°rios
        function displayUsersList(users) {
            const container = document.getElementById('usersContainer');
            
            if (users.length === 0) {
                container.innerHTML = '<div class="error">Nenhum usu√°rio encontrado</div>';
                return;
            }
            
            container.innerHTML = users.map(user => `
                <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #667eea; margin: 0;">${user.firstName} ${user.lastName}</h4>
                        <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                            ${user.role}
                        </span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div><strong>Email:</strong> ${user.email}</div>
                        <div><strong>Telefone:</strong> ${user.phone || 'N√£o informado'}</div>
                        <div><strong>Criado em:</strong> ${new Date(user.createdAt).toLocaleDateString('pt-BR')}</div>
                        <div><strong>√öltimo login:</strong> ${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString('pt-BR') : 'Nunca'}</div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" style="padding: 6px 12px; font-size: 0.8rem;" onclick="editUser('${user.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;" onclick="viewUser('${user.id}')">üëÅÔ∏è Ver</button>
                        <button class="btn" style="background: #dc3545; padding: 6px 12px; font-size: 0.8rem;" onclick="deleteUser('${user.id}')">üóëÔ∏è Excluir</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Mostrar formul√°rio de cria√ß√£o de usu√°rio
        function showCreateUserForm() {
            document.getElementById('createUserForm').style.display = 'block';
            document.getElementById('userPreferences').style.display = 'none';
        }
        
        // Esconder formul√°rio de cria√ß√£o de usu√°rio
        function hideCreateUserForm() {
            document.getElementById('createUserForm').style.display = 'none';
            // Limpar formul√°rio
            document.getElementById('firstName').value = '';
            document.getElementById('lastName').value = '';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('role').value = 'customer';
            document.getElementById('currency').value = 'BRL';
        }
        
        // Criar usu√°rio
        async function createUser() {
            const userData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                phone: document.getElementById('phone').value,
                role: document.getElementById('role').value,
                currency: document.getElementById('currency').value
            };
            
            // Valida√ß√£o b√°sica
            if (!userData.firstName || !userData.lastName || !userData.email || !userData.password) {
                showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                return;
            }
            
            try {
                const data = await apiRequest('/users/create', {
                    method: 'POST',
                    body: JSON.stringify(userData)
                });
                
                if (data.success) {
                    showMessage('Usu√°rio criado com sucesso!', 'success');
                    hideCreateUserForm();
                    loadUserStats(); // Atualizar estat√≠sticas
                    loadUsersList(); // Atualizar lista
                }
            } catch (error) {
                console.error('Erro ao criar usu√°rio:', error);
                showMessage('Erro ao criar usu√°rio: ' + error.message, 'error');
            }
        }
        
        // Mostrar prefer√™ncias de usu√°rio
        function loadUserPreferences() {
            document.getElementById('userPreferences').style.display = 'block';
            document.getElementById('createUserForm').style.display = 'none';
        }
        
        // Esconder prefer√™ncias de usu√°rio
        function hideUserPreferences() {
            document.getElementById('userPreferences').style.display = 'none';
        }
        
        // Salvar prefer√™ncias de usu√°rio
        async function saveUserPreferences() {
            const preferences = {
                notifications: {
                    email: document.getElementById('emailNotifications').checked,
                    sms: document.getElementById('smsNotifications').checked,
                    push: document.getElementById('pushNotifications').checked
                },
                privacy: {
                    showEmail: document.getElementById('showEmail').checked,
                    showPhone: document.getElementById('showPhone').checked,
                    showLocation: document.getElementById('showLocation').checked
                },
                timezone: document.getElementById('timezone').value,
                language: document.getElementById('language').value
            };
            
            try {
                const data = await apiRequest('/users/preferences', {
                    method: 'POST',
                    body: JSON.stringify(preferences)
                });
                
                if (data.success) {
                    showMessage('Prefer√™ncias salvas com sucesso!', 'success');
                }
            } catch (error) {
                console.error('Erro ao salvar prefer√™ncias:', error);
                showMessage('Erro ao salvar prefer√™ncias: ' + error.message, 'error');
            }
        }
        
        // Fun√ß√µes auxiliares para usu√°rios
        function editUser(userId) {
            showMessage('Funcionalidade de edi√ß√£o em desenvolvimento', 'info');
        }
        
        function viewUser(userId) {
            showMessage('Funcionalidade de visualiza√ß√£o em desenvolvimento', 'info');
        }
        
        function deleteUser(userId) {
            if (confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                showMessage('Funcionalidade de exclus√£o em desenvolvimento', 'info');
            }
        }
        
        // Fun√ß√£o para mostrar mensagens
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            let className = 'info';
            if (type === 'success') className = 'success';
            else if (type === 'error') className = 'error';
            else if (type === 'warning') className = 'warning';
            
            messageDiv.className = className;
            messageDiv.innerHTML = message; // Usar innerHTML para suportar HTML
            messageDiv.style.margin = '10px 0';
            messageDiv.style.padding = '15px';
            messageDiv.style.borderRadius = '10px';
            messageDiv.style.fontWeight = '500';
            
            // Adicionar ao topo do container
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Carregar dados iniciais
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar indicador de carregamento
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'flex';
            }
            
            // Carregar dados iniciais com timeout para evitar travamento
            setTimeout(async () => {
                try {
                    await refreshAll();
                    await loadOrders(); // Carregar pedidos automaticamente
                } catch (error) {
                    console.error('Erro no carregamento inicial:', error);
                } finally {
                    // Ocultar indicador de carregamento
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                }
            }, 1000); // Aguardar 1 segundo antes de carregar
            
            // Atualizar automaticamente a cada 60 segundos (reduzido)
            setInterval(refreshAll, 60000);
            
            // Atualizar pre√ßos e produtos a cada 30 segundos (reduzido)
            setInterval(async () => {
                await loadActiveAlerts(); // Pre√ßos ativos
                await loadRealProducts(); // Produtos dos fornecedores
            }, 30000);
            
            // Executar automa√ß√£o h√≠brida a cada 2 minutos - DESABILITADA PARA EVITAR CONFUS√ÉO
            /*
            setInterval(async () => {
                try {
                    updateAutomationIndicator(true);
                    await fetch('/api/hybrid-automation/run', { method: 'POST' });
                    console.log('üîÑ Automa√ß√£o h√≠brida executada automaticamente');
                    setTimeout(() => updateAutomationIndicator(false), 5000);
                } catch (error) {
                    console.log('‚ö†Ô∏è Erro na automa√ß√£o h√≠brida:', error.message);
                    updateAutomationIndicator(false);
                }
            }, 120000); // 2 minutos
            */
            
            // Automa√ß√£o removida - sem verifica√ß√£o de status
        });
    </script>
</body>
</html>

