<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Comportamento de MudanÃ§a de Idioma</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .step { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9; }
        .step h3 { margin-top: 0; color: #333; }
        .code { background: #f4f4f4; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
        .result { background: #e8f5e8; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .warning { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; }
        select { padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin: 5px; font-size: 16px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .simulation { background: #f0f8ff; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ Comportamento de MudanÃ§a de Idioma - Beauty Store</h1>
        
        <div class="step">
            <h3>ğŸ“‹ Passo 1: UsuÃ¡rio Seleciona PaÃ­s/Idioma</h3>
            <div class="simulation">
                <label>Selecione um paÃ­s:</label>
                <select id="countrySelector" onchange="simulateChangeCountry(this.value)">
                    <option value="BR">ğŸ‡§ğŸ‡· Brasil (R$)</option>
                    <option value="PT">ğŸ‡µğŸ‡¹ Portugal (â‚¬)</option>
                    <option value="US">ğŸ‡ºğŸ‡¸ United States ($)</option>
                </select>
                <button onclick="showCurrentState()">ğŸ” Ver Estado Atual</button>
            </div>
        </div>
        
        <div class="step">
            <h3>âš™ï¸ Passo 2: O que acontece internamente</h3>
            <div id="internal-process"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ’¾ Passo 3: localStorage Ã© atualizado</h3>
            <div id="localstorage-status"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ”„ Passo 4: PÃ¡gina Ã© recarregada</h3>
            <div id="reload-status"></div>
        </div>
        
        <div class="step">
            <h3>ğŸŒ Passo 5: Novo idioma Ã© aplicado</h3>
            <div id="translation-status"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ“Š Logs do Console</h3>
            <div id="console-logs"></div>
        </div>
    </div>

    <script>
        // Simular a funÃ§Ã£o changeCountry da beauty store
        function simulateChangeCountry(countryCode) {
            console.log('ğŸŒ [SIMULAÃ‡ÃƒO] Mudando paÃ­s para:', countryCode);
            
            // Passo 1: Salvar seleÃ§Ã£o no localStorage
            localStorage.setItem('selectedCountry', countryCode);
            
            // Passo 2: Mapear paÃ­s para idioma e moeda
            const countryInfo = {
                'BR': { language: 'pt-BR', currency: 'BRL', country: 'BR' },
                'PT': { language: 'pt-PT', currency: 'EUR', country: 'PT' },
                'US': { language: 'en-US', currency: 'USD', country: 'US' }
            };
            
            const info = countryInfo[countryCode] || countryInfo['US'];
            
            // Passo 3: Atualizar localStorage com informaÃ§Ãµes de idioma e moeda
            localStorage.setItem('userLanguage', info.language);
            localStorage.setItem('userCurrency', info.currency);
            localStorage.setItem('userCountry', info.country);
            
            console.log('ğŸŒ [SIMULAÃ‡ÃƒO] ConfiguraÃ§Ãµes atualizadas:', info);
            
            // Passo 4: Aplicar traduÃ§Ãµes manualmente (antes do reload)
            setTimeout(() => {
                applyManualTranslations();
            }, 100);
            
            // Passo 5: Simular reload da pÃ¡gina
            setTimeout(() => {
                simulatePageReload();
            }, 500);
            
            // Mostrar processo interno
            showInternalProcess(countryCode, info);
        }
        
        // Mostrar o processo interno
        function showInternalProcess(countryCode, info) {
            const process = `
                <div class="code">
                    <strong>1. changeCountry('${countryCode}') Ã© chamada</strong><br>
                    <strong>2. localStorage.setItem('selectedCountry', '${countryCode}')</strong><br>
                    <strong>3. Mapeamento de paÃ­s para idioma:</strong><br>
                    &nbsp;&nbsp;â€¢ PaÃ­s: ${info.country}<br>
                    &nbsp;&nbsp;â€¢ Idioma: ${info.language}<br>
                    &nbsp;&nbsp;â€¢ Moeda: ${info.currency}<br>
                    <strong>4. localStorage atualizado com:</strong><br>
                    &nbsp;&nbsp;â€¢ userLanguage: '${info.language}'<br>
                    &nbsp;&nbsp;â€¢ userCurrency: '${info.currency}'<br>
                    &nbsp;&nbsp;â€¢ userCountry: '${info.country}'<br>
                    <strong>5. applyManualTranslations() Ã© chamada</strong><br>
                    <strong>6. window.location.reload() Ã© executada</strong>
                </div>
            `;
            
            document.getElementById('internal-process').innerHTML = process;
        }
        
        // Simular aplicaÃ§Ã£o de traduÃ§Ãµes manuais
        function applyManualTranslations() {
            const selectedCountry = localStorage.getItem('selectedCountry') || 'US';
            const userLanguage = localStorage.getItem('userLanguage') || 'en-US';
            
            console.log('ğŸ”§ [SIMULAÃ‡ÃƒO] Aplicando traduÃ§Ãµes manuais para:', userLanguage);
            
            // TraduÃ§Ãµes bÃ¡sicas para demonstraÃ§Ã£o
            const translations = {
                'en-US': {
                    'product_foundation_title': '2 Pack PHOERA Foundation',
                    'btn_buy_now': 'Buy Now',
                    'newsletter_title': 'Stay updated with the latest news!'
                },
                'pt-BR': {
                    'product_foundation_title': 'Kit 2 Bases PHOERA',
                    'btn_buy_now': 'Comprar Agora',
                    'newsletter_title': 'Fique por dentro das novidades!'
                },
                'pt-PT': {
                    'product_foundation_title': 'Kit 2 Bases PHOERA',
                    'btn_buy_now': 'Comprar Agora',
                    'newsletter_title': 'Fique por dentro das novidades!'
                }
            };
            
            const currentTranslations = translations[userLanguage] || translations['en-US'];
            
            console.log('ğŸ”§ [SIMULAÃ‡ÃƒO] TraduÃ§Ãµes aplicadas:', currentTranslations);
            
            // Mostrar status das traduÃ§Ãµes
            showTranslationStatus(userLanguage, currentTranslations);
        }
        
        // Mostrar status das traduÃ§Ãµes
        function showTranslationStatus(userLanguage, translations) {
            const status = `
                <div class="result">
                    <strong>âœ… TraduÃ§Ãµes aplicadas para: ${userLanguage}</strong><br>
                    <strong>ğŸ“ Elementos traduzidos:</strong><br>
                    ${Object.keys(translations).map(key => 
                        `â€¢ ${key}: "${translations[key]}"`
                    ).join('<br>')}
                </div>
            `;
            
            document.getElementById('translation-status').innerHTML = status;
        }
        
        // Simular reload da pÃ¡gina
        function simulatePageReload() {
            console.log('ğŸ”„ [SIMULAÃ‡ÃƒO] PÃ¡gina sendo recarregada...');
            
            const reloadStatus = `
                <div class="warning">
                    <strong>ğŸ”„ PÃ¡gina sendo recarregada...</strong><br>
                    <strong>ğŸ“„ language-controller.js serÃ¡ carregado novamente</strong><br>
                    <strong>ğŸŒ detectUserLanguage() lerÃ¡ o localStorage</strong><br>
                    <strong>ğŸ“š loadTranslationFile() carregarÃ¡ o arquivo correto</strong><br>
                    <strong>ğŸ¯ applyCurrentPageTranslations() aplicarÃ¡ as traduÃ§Ãµes</strong>
                </div>
            `;
            
            document.getElementById('reload-status').innerHTML = reloadStatus;
            
            // Simular o que acontece apÃ³s o reload
            setTimeout(() => {
                simulateAfterReload();
            }, 1000);
        }
        
        // Simular o que acontece apÃ³s o reload
        function simulateAfterReload() {
            const userLanguage = localStorage.getItem('userLanguage') || 'en-US';
            const selectedCountry = localStorage.getItem('selectedCountry') || 'US';
            const userCurrency = localStorage.getItem('userCurrency') || 'USD';
            
            const afterReload = `
                <div class="result">
                    <strong>âœ… ApÃ³s o reload:</strong><br>
                    <strong>ğŸŒ Idioma detectado:</strong> ${userLanguage}<br>
                    <strong>ğŸ³ï¸ PaÃ­s selecionado:</strong> ${selectedCountry}<br>
                    <strong>ğŸ’° Moeda:</strong> ${userCurrency}<br>
                    <strong>ğŸ“š Arquivo de traduÃ§Ã£o carregado:</strong> translation-${userLanguage.replace('-', '-')}.js<br>
                    <strong>ğŸ¯ TraduÃ§Ãµes aplicadas:</strong> Todos os elementos com data-translate-key
                </div>
            `;
            
            document.getElementById('reload-status').innerHTML = afterReload;
        }
        
        // Mostrar estado atual
        function showCurrentState() {
            const userLanguage = localStorage.getItem('userLanguage') || 'en-US';
            const selectedCountry = localStorage.getItem('selectedCountry') || 'US';
            const userCurrency = localStorage.getItem('userCurrency') || 'USD';
            
            const status = `
                <div class="result">
                    <strong>ğŸ“Š Estado Atual do localStorage:</strong><br>
                    <strong>ğŸŒ userLanguage:</strong> ${userLanguage}<br>
                    <strong>ğŸ³ï¸ selectedCountry:</strong> ${selectedCountry}<br>
                    <strong>ğŸ’° userCurrency:</strong> ${userCurrency}
                </div>
            `;
            
            document.getElementById('localstorage-status').innerHTML = status;
        }
        
        // Capturar logs do console
        function captureConsoleLogs() {
            const originalLog = console.log;
            const logs = [];
            
            console.log = function(...args) {
                logs.push(args.join(' '));
                originalLog.apply(console, args);
            };
            
            // Mostrar logs capturados
            setInterval(() => {
                if (logs.length > 0) {
                    const logHtml = logs.slice(-5).map(log => `<div style="background: #f0f0f0; padding: 5px; margin: 2px 0; border-radius: 3px; font-family: monospace; font-size: 12px;">${log}</div>`).join('');
                    document.getElementById('console-logs').innerHTML = logHtml;
                }
            }, 1000);
        }
        
        // Inicializar
        window.addEventListener('load', () => {
            showCurrentState();
            captureConsoleLogs();
            
            // Mostrar processo inicial
            document.getElementById('internal-process').innerHTML = `
                <div class="warning">
                    <strong>â³ Aguardando seleÃ§Ã£o de paÃ­s...</strong><br>
                    Selecione um paÃ­s no dropdown acima para ver o processo completo.
                </div>
            `;
        });
    </script>
</body>
</html>
